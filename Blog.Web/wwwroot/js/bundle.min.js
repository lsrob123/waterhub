var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},ApiCallResult=function(){function n(){}return n.prototype.withSuccess=function(n,t){return t===void 0&&(t=200),this.ok=!0,this.status=200,this.data=n,this},n.prototype.withError=function(n,t,i){return this.ok=!1,this.status=t,this.statusText=i,this.data=undefined,this.message=n,this},n.prototype.withLocalError=function(n){return this.ok=!1,this.data=undefined,this.message=n,this},n}(),Tag=function(){function n(){}return n}(),Post=function(){function n(){}return n}(),PostInfoEntry=function(){function n(){}return n}(),Service=function(){function n(){var n=this;this.upsertPost=function(t,i,r,u,f,e,o){return __awaiter(n,void 0,void 0,function(){var n,h,c,s;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,5,,6]),[4,fetch("/api/posts",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t,title:i,abstract:r,content:u,isSticky:!!f,isPublished:!!e,tags:o})})];case 1:return(n=l.sent(),!!!n.ok)?[3,3]:[4,n.json()];case 2:return h=l.sent(),[2,(new ApiCallResult).withSuccess(h)];case 3:return[4,n.text()];case 4:return c=l.sent(),[2,(new ApiCallResult).withError(c,n.status,n.statusText)];case 5:return s=l.sent(),console.error(s),[2,(new ApiCallResult).withLocalError(s)];case 6:return[2]}})})};this.listLatestPosts=function(){return __awaiter(n,void 0,void 0,function(){var n,t,i;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),[4,fetch("/api/posts/latest",{method:"GET"})];case 1:return(n=r.sent(),!!!n.ok)?[3,3]:[4,n.json()];case 2:return t=r.sent(),[2,t];case 3:return[2,[]];case 4:return i=r.sent(),console.error(i),[2,null];case 5:return[2]}})})};this.listLatestPostInfoEntries=function(t){return t===void 0&&(t=!1),__awaiter(n,void 0,void 0,function(){var i,n,r,u;return __generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,4,,5]),i=t?"/api/posts/info/latest/all":"/api/posts/info/latest",[4,fetch(i,{method:"GET"})];case 1:return(n=f.sent(),!!!n.ok)?[3,3]:[4,n.json()];case 2:return r=f.sent(),[2,r];case 3:return[2,[]];case 4:return u=f.sent(),console.error(u),[2,null];case 5:return[2]}})})};this.listPostInfoEntriesByKeywords=function(t,i){return i===void 0&&(i=!1),__awaiter(n,void 0,void 0,function(){var r,n,u,f;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),r=i?"/api/posts/info/all":"/api/posts/info",[4,fetch(r+"?keywords="+t,{method:"GET"})];case 1:return(n=e.sent(),!!!n.ok)?[3,3]:[4,n.json()];case 2:return u=e.sent(),[2,u];case 3:return[2,[]];case 4:return f=e.sent(),console.error(f),[2,null];case 5:return[2]}})})}}return n.prototype.getUrl=function(n){var t=new RegExp(/^.*\//).exec(window.location.href);return encodeURI(""+t+n)},n}(),HomeScreen=function(){function n(n){var t=this;this.startSearch=function(){return __awaiter(t,void 0,void 0,function(){var i,n,t,r,u;return __generator(this,function(f){switch(f.label){case 0:return(i=this.searchBox.value,!i)?[2]:[4,this.service.listPostInfoEntriesByKeywords(i)];case 1:if(n=f.sent(),this.searchDropDown.innerHTML="",!n||n.length===0)return[2];for(this.searchDropDown.innerHTML=n.reduce(function(n,t){var i="<a href=\"javascript:homeScreen.displayFullContent('"+t.title+"','"+t.urlFriendlyTitle+'\')" title="'+t.textClickToReadFullArticle+'">'+t.textReadFullArticle+"<\/a>",r='<a href="~/posts/'+t.urlFriendlyTitle+'" title="'+t.textOpenArticleInNewWindow+'" target="'+t.urlFriendlyTitle+'">'+t.textOpenArticleInNewWindow+"<\/a>";return n+"<div>"+i+" "+r+"<\/div>"},""),t=0,r=n;t<r.length;t++)u=r[t];return[2]}})})};this.searchBoxDebounceId=null;this.isSearchBoxFocused=!1;this.onSearchBoxUpdated=function(){(!t.searchBoxDebounceId||(clearTimeout(t.searchBoxDebounceId),t.searchBoxDebounceId=null),t.isSearchBoxFocused)&&(t.searchBoxDebounceId=window.setTimeout(function(){this.showSearchDropDown();!this.isSearchBoxFocused||this.startSearch()},500))};this.onSearchBoxFocused=function(){t.isSearchBoxFocused=!0;t.showSearchDropDown()};this.onSearchBoxBlurred=function(){t.isSearchBoxFocused=!1};this.clearSearch=function(){t.searchBox.value=null;t.searchDropDown.innerHTML="";t.hideSearchdropDown()};this.service=n}return Object.defineProperty(n.prototype,"searchBox",{get:function(){return document.getElementById("home-search-box")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"searchDropDown",{get:function(){return document.getElementById("home-search-dropdown")},enumerable:!0,configurable:!0}),n.prototype.hideSearchdropDown=function(){this.searchDropDown.style.display="none"},n.prototype.showSearchDropDown=function(){this.searchDropDown.style.display="block"},n}(),AdminScreen=function(){function n(n){var t=this;this.tags=[];this.allTags=[];this.init=function(n){t.editorInstance=n;t.editorInstance.value=document.getElementById("PostInEdit_Content").value;t.tags=JSON.parse(document.getElementById("PostInEdit_TagsInText").value);t.tags||(t.tags=[]);t.renderTags();t.allTags=JSON.parse(document.getElementById("AllTagsInText").value);t.allTags||(t.allTags=[]);t.renderAllTags()};this.loadDataAsync=function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadLatestPostInfoEntries()];case 1:return n.sent(),[2]}})})};this.deleteTag=function(n){t.tags.splice(n,1);t.renderTags()};this.addNewTags=function(){var n=document.getElementById("edit-new-tag").value,i;n&&n.trim()!==""&&(i=n.split(/[ ,;:.]+/g),i.length!==0)&&(i.map(function(n){var i=t.tags.findIndex(function(t){return t===n});return i<0&&t.tags.push(n),!0}),t.renderTags())};this.selectTag=function(){var n=t.allTagsDropdown,i,r;n.selectedIndex!==0&&((i=n.options[n.options.selectedIndex].value,r=t.tags.findIndex(function(n){return n===i}),r>=0)||(t.tags.push(i),t.renderTags()))};this.upsertPost=function(){return __awaiter(t,void 0,void 0,function(){var n,t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.service.upsertPost(document.getElementById("PostInEdit_Key").value,document.getElementById("PostInEdit_Title").value,document.getElementById("PostInEdit_Abstract").value,this.editorInstance.value,!!document.getElementById("PostInEdit_IsSticky").checked,!!document.getElementById("PostInEdit_IsPublished").checked,this.tags)];case 1:return n=i.sent(),n.ok?(t="/admin/"+n.data.urlFriendlyTitle,document.getElementById("post-submit-result").innerHTML='<div style="color:darkgreen;margin-bottom:15px;">Post submitted successfully.<\/div><div><a href="'+t+'" target="_self">Refresh Page<\/a><\/div>',window.setTimeout(function(){window.location.href=t},1e3)):document.getElementById("post-submit-result").innerHTML='<span style="color:darkred;">'+n.status+" "+n.statusText+"<br />"+n.message+"<span>",window.setTimeout(function(){document.getElementById("post-submit-result").innerHTML=""},1e4),[2]}})})};this.createPost=function(){window.location.href=t.service.getUrl("")};this.loadLatestPostInfoEntries=function(){return __awaiter(t,void 0,void 0,function(){var n;return __generator(this,function(t){switch(t.label){case 0:return n=this,[4,this.service.listLatestPostInfoEntries(!0)];case 1:return n.postInfoEntries=t.sent(),this.isPostListFromLatest=!0,this.renderPostList(),[2]}})})};this.loadPostInfoEntriesByKeywords=function(){return __awaiter(t,void 0,void 0,function(){var n;return __generator(this,function(t){switch(t.label){case 0:return n=this,[4,this.service.listPostInfoEntriesByKeywords(this.keywords,!0)];case 1:return n.postInfoEntries=t.sent(),this.isPostListFromLatest=!1,this.renderPostList(),[2]}})})};this.displayFullContent=function(n,i){t.modalFullArticle.style.display="flex";t.columnContainer.style.overflow="hidden";t.modalPostTitle.innerHTML=n;t.modalPostContent.innerHTML=document.getElementById("div-"+i).innerHTML};this.collapseFullContent=function(){t.modalFullArticle.style.display="none";t.columnContainer.style.overflow="auto";t.modalPostTitle.innerHTML=null;t.modalPostContent.innerHTML=null};this.service=n}return Object.defineProperty(n.prototype,"hasAllTags",{get:function(){return!!this.allTags&&this.allTags.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allTagsDropdown",{get:function(){return document.getElementById("edit-all-tags")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"postInfoEntriesElement",{get:function(){return document.getElementById("edit-post-list")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"keywords",{get:function(){return document.getElementById("edit-post-search-keywords").value},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"columnContainer",{get:function(){return document.getElementById("column-container")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"modalFullArticle",{get:function(){return document.getElementById("modal-full-article")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"modalPostTitle",{get:function(){return document.getElementById("modal-post-title")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"modalPostContent",{get:function(){return document.getElementById("modal-post-content")},enumerable:!0,configurable:!0}),n.prototype.renderPostList=function(){var n,t,i,r;if(this.postInfoEntriesElement.innerHTML="",this.postInfoEntries){if(n=this.isPostListFromLatest?'<div class="current-post-list-type">Latest posts loaded.<\/div>':'<div class="current-post-list-type">Search results loaded.<\/div>',this.postInfoEntries.length===0)n+="<div>(Empty Results)<\/div>";else for(t=0,i=this.postInfoEntries;t<i.length;t++)r=i[t],n+='<div><a href="/admin/'+r.urlFriendlyTitle+'" target="_self">'+r.title+"<\/a><\/div>";this.postInfoEntriesElement.innerHTML=n}},n.prototype.renderTags=function(){this.tags=this.tags.sort(function(t,i){return n.tagComparitor(t,i)});var t=this.tags.reduce(function(n,t,i){return n+' <div class="tag">'+t+' <a href="javascript:adminScreen.deleteTag('+i+')"><img src="/images/delete.svg" /><\/a><\/div> '},"");document.getElementById("edit-tags").innerHTML=t},n.prototype.renderAllTags=function(){var t=this.allTagsDropdown;(t.options.length=0,this.allTags&&this.allTags.length!==0)&&(this.allTags=this.allTags.sort(function(t,i){return n.tagComparitor(t,i)}),t.add(new Option("","")),this.allTags.map(function(n){return t.add(new Option(n,n)),!0}))},n.tagComparitor=function(n,t){return n>t?1:n<t?-1:0},n}(),service=new Service,homeScreen=new HomeScreen(service),adminScreen=new AdminScreen(service);
//# sourceMappingURL=bundle.min.js.map